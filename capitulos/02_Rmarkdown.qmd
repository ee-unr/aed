---
title: "Comunicaci칩n de Resultados: R Markdown"
subtitle: "An치lisis Exploratorio de Datos | Licenciatura en Estad칤stica | FCEyE | UNR"
lang: es
knitr:
  opts_chunk: 
    echo: true
    message: false
    warning: false
    fig.align: center
---

<!-- themes: https://bootswatch.com/ -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE, fig.align = "center", out.width = "75%")
```

# Introducci칩n

* Los contenidos de esta unidad est치n motivados por el concepto de **comunicaci칩n eficiente**.

* Esta idea se encuentra 칤ntimamente ligada al contexto en el cual nos desempe침amos. No es lo mismo escribir una tesis acad칠mica, que un reporte para uso interno dentro de una empresa, que generar un informe que ser치 publicado en redes sociales. La manera en que presentamos los resultados, el lenguaje que utilizamos, el formato de salida y muchas otras caracter칤sticas depender치n del p칰blico al que va dirigido el mensaje.

* Como ya sabemos, la aparici칩n de nuevas herramientas inform치ticas ha revolucionado la manera en que nos comunicamos, no s칩lo a trav칠s del lenguaje oral, sino tambi칠n del escrito. En particular, consideramos que existen dos paradigmas muy arraigados que necesitan ser repensados (no eliminados) dado el contexto actual:


    1. El concepto de informe **est치tico**, generalmente impreso en papel o compartido en formato Word, PDF, PowerPoint, etc. En ocasiones es aconsejable otorgarle cierto poder de decisi칩n al usuario/a que leer치 el informe, d치ndole la posibilidad de elegir qu칠 variables o categor칤as graficar, c칩mo ordenar las tablas presentadas, etc. En este sentido, repasaremos algunas herramientas para dinamizar y hacer interactivos los informes que elaboramos: **R Markdown**, y m치s adelante, **R Shiny** y **Power BI**.

    2. El concepto de informe **definitivo**. Muchas veces parece que hemos llegado a un punto final, a partir del cual no hay lugar para la actualizaci칩n, la mejora o la revisi칩n del trabajo realizado. 쯈u칠 pasa si descubrimos un error de carga en los datos y es necesario cambiar todos los resultados? O bien, 쯤u칠 hacemos si hay nueva informaci칩n disponible y tambi칠n queremos actualizar el material? En este punto, R sale otra vez al rescate, gracias a su flujo de trabajo **integrado** y f치cilmente **reproducible**.

* Para reproducir los ejemplos de este apunte, necesitamos los siguientes paquetes:

```{r}
library(DT)
library(kableExtra)
library(tinytex)
library(tidyverse)
library(knitr)
library(rmarkdown)
```

**Disclaimer:** la autor칤a de este material corresponde en parte al profesor Marcos Prunello.

# Qu칠 es R Markdown

* En R, la posibilidad de entrelazar el an치lisis estad칤stico con la generaci칩n de reportes se logra a trav칠s de **R Markdown** y todos sus productos derivados. Estas herramientas pueden ser utilizadas, entre otras cosas, para construir:


    * Informes o reportes laborales
    * Presentaciones con diapositivas
    * Art칤culos acad칠micos (papers)
    * P치ginas web
    * Blogs
    * Libros (s칤, libros enteros)

<p></p>

* Estamos acostumbrados a realizar estas tareas con diferentes programas: Word para documentos que contienen una gran cantidad de texto, PowerPoint para presentaciones, Excel para reportes que incluyen tablas y gr치ficos, etc. 쯇or qu칠 deber칤amos pensar en cambiar estas costumbres? Existen tres razones que podemos agregar a los ya mencionados cambios de paradigma:


    1. **Integraci칩n:** si trabajamos con R podemos llevar a cabo todos los pasos del proceso de an치lisis mediante el mismo software (no m치s copiado y pegado de resultados de R a otros programas). Es posible escribir art칤culos, lanzar p치ginas web o publicar libros sin salir de RStudio.
    
    2. **Replicaci칩n:** la estructura de trabajo de R Markdown facilita su replicabilidad, ya que gracias a la mencionada integraci칩n, todos los pasos del proceso se encuentran contenidos en un solo lugar: lectura y limpieza de datos, an치lisis estad칤stico, ajuste de modelos, escritura de texto y conclusiones, generaci칩n de un reporte que incluya resultados, tablas, gr치ficos, c칩digo utilizado, etc. [Algunos autores](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6255984/) definen la replicaci칩n como una parte esencial del m칠todo cient칤fico.
    
    3. **Salto de Categor칤a:** la calidad de los archivos generados y las opciones de personalizaci칩n que podemos alcanzar con R son enormes, d치ndole un aspecto mucho m치s profesional a nuestro trabajo.


* Pero, 쯤u칠 es **Markdown**? Es el nombre de un lenguaje de *marcado ligero* que sirve para producir distintos tipos de documentos, a partir de una sintaxis donde las sentencias incluyen exclusivamente el uso de caracteres b치sicos. Adem치s, se guardan en archivos de texto plano, sin formato.

* Si bien este lenguaje fue desarrollado originalmente para producir textos de p치ginas web y as칤 simplificar la escritura de c칩digo HTML, su dise침o permite convertir un documento de tipo *markdown* a una gran variedad de formatos de salida. Generalmente se usa para escribir archivos *README* o documentaci칩n, publicaciones en foros online, servicios de mensajer칤a instant치nea, etc.

* El formato de documentos **R Markdown** se encarga de incorporar este tipo de escritura en R para poder combinar texto, c칩digo y salidas en la creaci칩n de archivos publicables de excelente calidad, resultando en un proceso de creaci칩n *relativamente* sencillo.

* Los paquetes que implementan todo esto son `rmarkdown` y `knitr`:

<center> ![](rmarkdown.png){#id .class width=150px} ![](knitr.png){#id .class width=150px} </center>
<p></p>

* Podemos elegir diferentes formatos de salida, entre ellos **HTML**, **PDF**, **Word** y **PowerPoint**. Si bien en esta clase nos enfocaremos 칰nicamente en los dos primeros, aquellos interesados en conocer m치s sobre la conexi칩n entre R Markdown y Word pueden consultar este [tutorial](https://rmarkdown.rstudio.com/articles_docx.html). Por otro lado, una peque침a introducci칩n a la relaci칩n R Markdown - PowerPoint puede encontrarse en el cap칤tulo 4.4 de [R Markdown - The Definitive Guide](https://bookdown.org/yihui/rmarkdown/).

::: {.callout-note}

## Aclaraci칩n

En 2022 **Posit** (la compa침칤a antes llamada RStudio) relanz칩 R Markdown bajo el nombre de **Quarto**. Si bien este nuevo producto posee algunas diferencias con respecto al original, estas son m칤nimas, y todo lo que figura a continuaci칩n puede aplicarse en cualquiera de las dos versiones.

:::

# Primeros Pasos

* Un documento R Markdown b치sico puede crearse de forma sencilla con RStudio accediendo a *File > New File > R Markdown*, o bien haciendo click en la cruz blanca sobre fondo verde y eligiendo R Markdown en el men칰 desplegable:

```{r, echo=FALSE}
knitr::include_graphics('iniciarRmd.png')
```

* En la siguiente ventana se nos pregunta qu칠 tipo de documento queremos crear, con varias opciones disponibles:


    * Documento de texto (HTML, PDF o Word)
    * Presentaci칩n (diapositivas)
    * Shiny (*app* que puede ejecutarse a trav칠s de un navegador web e incorpora contenido interactivo)
    * Desde un *template* (documentos con formato pre-seteado provistos por algunos paquetes)

```{r, echo=FALSE, out.width="50%"}
knitr::include_graphics('elformato.png')
```

* Podemos tomar de ejemplo un documento de texto en formato **HTML**. 
* Una vez elegido el tipo de documento, RStudio ofrece por defecto una plantilla que incluye varias secciones, las cuales analizaremos en detalle a continuaci칩n. Es importante notar que, a diferencia de los archivos de c칩digo comunes (con extensi칩n **.R**), este archivo posee la extensi칩n **.Rmd** (o bien *.qmd* si usamos Quarto).
* Debemos guardar este documento en alguna carpeta de nuestra compu.
* Su estructura general se representa en la siguiente imagen:

```{r, fig.show='hold', echo=FALSE}
knitr::include_graphics('partesRmd.png')
```

## Encabezado

* El encabezado, tambi칠n conocido como *YAML Metadata*, se coloca al comienzo del documento entre dos tiras de guiones. Aqu칤 se incluyen el t칤tulo del documento y subt칤tulo si lo tuviera, autor, fecha y varias opciones m치s.

* En `output` se indica el formato de salida que se desea; si bien esta opci칩n se genera autom치ticamente al elegir el formato en la pantalla anterior, podemos modificarlo manualmente si cambiamos de opini칩n.

```
---
title: "Mi Primer Markdown en HTML"
subtitle: "AED | Lic. en Estad칤stica | FCEyE | UNR"
author: "Diego & Iv치n"
date: "Agosto 2024"
output: html_document
---
```

* M치s adelante mencionaremos m치s opciones que dependen del output elegido.

## Texto

* Para la escritura de texto se usa el lenguaje **Pandoc's Markdown**, una extensi칩n del Markdown original. Un amplio manual sobre esta herramienta puede consultarse en la [web oficial de Pandoc](https://pandoc.org/MANUAL.html), un software libre que se utiliza para convertir documentos de un formato a otro.

* En la siguiente tabla mostramos algunos *trucos* para darle un aspecto m치s interesante al texto que escribimos en R Markdown:

```{r, echo=FALSE, out.width="50%"}
knitr::include_graphics('formatotxt.png')
```

* Los encabezados de cada secci칩n se definen mediante numerales: un numeral equivale a un t칤tulo principal, dos numerales a un subt칤tulo, tres numerales a un sub-subt칤tulo, etc.:

```{r, echo=FALSE, out.width="50%"}
knitr::include_graphics('titulos.png')
```

* Por defecto, el 칤ndice de un documento R Markdown incluye los encabezados de nivel 1, 2 y 3. Si queremos cambiar este comportamiento, podemos utilizar la opci칩n `toc_depth: x` dentro del encabezado, para mostrar los niveles 1 a *x*.

* Recomendamos dejar un espacio entre el numeral y el t칤tulo de la secci칩n (`# T칤tulo`), ya que para ciertos formatos de salida de R Markdown, la expresi칩n `#T칤tulo` no ser치 reconocida como tal.

* Para iniciar un nuevo p치rrafo en *Pandoc* debemos dejar dos espacios al final de una l칤nea de texto o bien un rengl칩n vac칤o entre una cadena de texto y la otra. Con un solo **Enter** no lograremos nada.

## C칩digo

* Para a침adir c칩digo dentro de un documento **Rmd** es necesario insertar un `chunk`, t칠rmino que podemos traducir como *pedazo* o *bloque*. Las dos maneras m치s directas de hacerlo son:


    1. Apretar las teclas Ctrl + Alt + i, o bien...
    2. Hacer click en el 칤cono `Insert` en la barra de edici칩n y elegir la primera opci칩n (R). Tambi칠n es posible insertar chunks que contengan sentencias escritas en otros lenguajes (Python, SQL, Stan, etc.)

<p></p>

* Dentro de estos bloques podemos escribir c칩digo de R, tal como lo hacemos regularmente en un archivo de sentencias com칰n y corriente. En lo posible, se recomienda crear bloques relativamente aut칩nomos y enfocados en una sola tarea: por ejemplo, un bloque para importar datos, otro para ajustes, otro para generar gr치ficos, etc.

* Para correr todo el c칩digo presente en un bloque se puede usar el atajo `Ctrl + Shift + Enter` o bien el tri치ngulo verde ubicado en la parte superior derecha del chunk.

* La salida generada por cada chunk puede personalizarse con distintos argumentos que se indican en su encabezado. El paquete **knitr** provee casi 60 opciones para personalizar chunks: [ac치 podemos consultar la lista completa](http://yihui.name/knitr/options/).

* A continuaci칩n repasamos algunas de los m치s 칰tiles:


    * `eval = TRUE/FALSE` define si el c칩digo de ese chunk debe ejecutarse, o no (en este caso no se generan resultados). Esta opci칩n es 칰til para mostrar ejemplos de sentencias que no deseamos correr, o bien para deshabilitar la ejecuci칩n de un gran bloque de c칩digo sin comentar cada l칤nea.

    * `echo = TRUE/FALSE` define si el c칩digo se muestra en el documento final, o no. Por defecto todo chunk se ejecuta y se imprime. Dado que en numerosas ocasiones no deseamos que nuestro c칩digo se haga p칰blico, la opci칩n `echo = FALSE` es una de las m치s utilizadas.

    * `message`, `warning` y `error` definen si los mensajes, advertencias o errores generados por las funciones ejecutadas dentro del chunk deben mostrarse (`TRUE`) o no (`FALSE`).
    
    * `results` define qu칠 hacer con los resultados del c칩digo presente en ese chunk: imprimir con formato (`"markup"`), sin formato (`"asis"`), no imprimir (`"hide"`) o imprimir todo junto al final (`"hold"`).

    * `fig.height` y `fig.width` definen el alto y el ancho (en pulgadas) de los gr치ficos generados por ese chunk.
    
    * `out.width` define el ancho de los gr치ficos generados por ese chunk, con respecto al tama침o relativo de la p치gina; por ejemplo `out.width="75%"` imprime un gr치fico que ocupa las tres cuartas partes del ancho total.
    
    * `fig.align` define la justificaci칩n de la imagen: a la izquierda (`"left"`), centradas (`"center"`) o a la derecha (`"right"`).
    
    * `fig.cap` define el texto que describe el gr치fico generado (*caption*), el cual se ubica debajo de la imagen.

<p></p>

* Los chunks pueden recibir nombres, que no deben repetirse a lo largo del documento. Esta opci칩n facilita la organizaci칩n en archivos extensos, permite crear v칤nculos a resultados de chunks espec칤ficos a lo largo del documento, y adem치s, nos ayuda a encontrar y resolver problemas de forma m치s eficaz.

* Un ejemplo de chunk bautizado *BloqueMuyImportante* con algunas opciones luce as칤:

````markdown
`r ''````{r BloqueMuyImportante, warning=TRUE, echo=TRUE}
`r ''` datos <- read_excel("Plantilla.xlsx")
`r ''` summary(datos)
`r ''````
````

* Las opciones de personalizaci칩n de chunks, tal como las escribimos hasta ahora, afectan s칩lo al c칩digo contenido dentro de ese bloque. Si deseamos definir estas opciones de manera **global**, de tal manera que abarquen a todos los chunks del documento, podemos hacerlo mediante la funci칩n `opts_chunk()` del paquete `knitr`.

* Es com칰n que el primer chunk del archivo contenga un llamado a esta funci칩n, definiendo los detalles globales de todos los bloques generados en el resto del documento. Generalmente se le da el nombre *setup*, aunque esto es opcional. Por ejemplo:

````markdown
`r ''````{r setup, include = FALSE}
`r ''`knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, 
`r ''`                      comment = NA, fig.align = "center", out.width = "100%")
`r ''````
````

Si quiero cambiar el comportamiento definido en `opts_chunk()` s칩lo en algunos bloques determinados, alcanza con volver a definir las opciones en sus respectivos encabezados.

## Compilar

Para generar el documento definitivo basta con cliquear el bot칩n **Knit** (literalmente, *tejer*) que se encuentra en la barra de herramientas de RStudio:

```{r, echo=FALSE, out.width="60%"}
knitr::include_graphics('botonknitr.png')
```

* Otra opci칩n para generar documentos es utilizar la funci칩n `render()` del paquete `rmarkdown`:

```{r, eval=FALSE}
render("MiArchivo.Rmd")
```

**Para tener en cuenta:** 

- Al momento de generar un documento, R s칩lo podr치 utilizar los objetos definidos dentro del **Rmd** mismo: de nada sirve cargar un objeto en nuestro ambiente de trabajo, si luego no replicamos esa sentencia en el Markdown.

- Al lado del bot칩n **Knit** hay una lista desplegable que nos permite elegir otro formato de salida, diferente al que tenemos indicado por default.

# Herramientas 칰tiles

## Listas

* Para crear listas de elementos no numerados, podemos usar un asterisco (*) o bien un guion (-). Si deseamos agregar sublistas dentro de algunas listas, el asterisco o guion debe estar precedido una tabulaci칩n o cuatro espacios.

* Por otro lado, para listas numeradas debemos agregar al principio de cada elemento el n칰mero correspondiente a cada 칤tem, seguido de un punto (1., 2., etc.). Si no tenemos ganas de contar la cantidad de 칤tems, podemos usar la numeraci칩n 1. para cada elemento y R har치 los incrementos autom치ticamente:

```{r, echo=FALSE, out.width="50%"}
knitr::include_graphics('listas.png')
```

## Enlaces

* Para a침adir links a p치ginas web se puede escribir lo siguiente: `[Link a la p치gina web de la FCEyE-UNR](https://www.fcecon.unr.edu.ar/)`, lo cual se mostrar치 as칤: [Link a la p치gina web de la FCEyE-UNR](https://www.fcecon.unr.edu.ar/).

* Si queremos que el link quede visible, podemos escribir `<https://www.fcecon.unr.edu.ar>` y se ver치 as칤: <https://www.fcecon.unr.edu.ar>.


## Im치genes

* Si queremos insertar im치genes dentro de nuestro documento, recomendamos utilizar la funci칩n `include_graphics()` de `knitr`:

````markdown
`r ''````{r, out.width="50%"}
`r ''`knitr::include_graphics("C:/Mis Documentos/messi.jpg")
`r ''````
````

```{r, echo=FALSE, out.width="50%"}
knitr::include_graphics("messi.jpg")
```


* Este recurso es v치lido para im치genes de formato *png*, *jpg*, *gif*, *pdf* (entre otros) que est칠n guardadas en nuestra PC o que se encuentren alojadas online. 

* No es necesario utilizar esta funci칩n si queremos incluir un gr치fico generado dentro de R, directamente escribimos el c칩digo correspondiente en un chunk (que seguramente queramos dejar oculto):


````markdown
`r ''````{r, out.width = "60%", echo = TRUE}
`r ''`ggplot(mpg) +
`r ''`  aes(x = cty, fill = factor(cyl)) +
`r ''`  geom_density(alpha = 0.8) +
`r ''`  labs(title = "Gr치fico de densidad", 
`r ''`       subtitle = "Millaje en ciudad seg칰n n칰mero de cilindros",
`r ''`       caption = "Fuente: datos mpg",
`r ''`       x = "Millas por gal칩n", y = "Densidad",
`r ''`       fill = "Nro de cilindros") +
`r ''`  theme(legend.position = "bottom")
`r ''````
````

```{r, out.width = "60%", echo = FALSE}
ggplot(mpg) +
  aes(x = cty, fill = factor(cyl)) +
  geom_density(alpha = 0.8) +
  labs(title = "Gr치fico de densidad", 
       subtitle = "Millaje en ciudad seg칰n n칰mero de cilindros",
       caption = "Fuente: datos mpg",
       x = "Millas por gal칩n", y = "Densidad",
       fill = "Nro de cilindros") +
  theme(legend.position = "bottom")
```

## Tablas

* Frecuentemente necesitamos presentar tablas con resultados de nuestros an치lisis.
* Por ejemplo, el promedio de algunas variables calculado seg칰n la cantidad de cilindros que tienen los autos listados en el dataset `mtcars`, como vemos a continuaci칩n:

```{r}
resultado <- mtcars %>% 
  group_by(cyl) %>% 
  summarise_at(c(1, 3:7), mean)

resultado
```

<br>

* Tambi칠n podemos recurrir a la sintaxis de Markdown para crear tablas, que indica que hay definir el encabezado separ치ndolo con guiones del resto de las filas e identificar las columnas con barras verticales.

* Por ejemplo:

  ```
  | cyl|   mpg|     hp| drat|   wt|  qsec|   vs|
  |:--:|-----:|------:|----:|----:|-----:|----:|
  |   4| 26.66|  82.64| 4.07| 2.29| 19.14| 0.91|
  |   6| 19.74| 122.29| 3.59| 3.12| 17.98| 0.57|
  |   8| 15.10| 209.21| 3.23| 4.00| 16.77| 0.00|
  ```
  
* Debajo vemos los resultados en nuestros archivos compilados, primero en versi칩n html y luego en pdf:
  
  | cyl|   mpg|     hp| drat|   wt|  qsec|   vs|
  |:--:|-----:|------:|----:|----:|-----:|----:|
  |   4| 26.66|  82.64| 4.07| 2.29| 19.14| 0.91|
  |   6| 19.74| 122.29| 3.59| 3.12| 17.98| 0.57|
  |   8| 15.10| 209.21| 3.23| 4.00| 16.77| 0.00|
    
  
```{r, echo = FALSE, out.width="60%"}
knitr::include_graphics("tabla1_pdf.png")
```
  
* Hay p치ginas que nos ayudan a generar esas tablas con guiones y barras (recomendamos explorar la web [Tables Generator](https://www.tablesgenerator.com/markdown_tables)), pero la idea es no hacerlo a mano.

* Existen muchos paquetes muy potentes para este configurar cualquier aspecto de las tablas (como `xtable`, `huxtable`, `formattable`, `kableExtra` y varios otros) con opciones que en algunos casos son espec칤ficas para cada formato de salida. Cada uno provee herramientas particulares para generar tablas con formato a partir c칩digo de R.

## C칩digo din치mico

* Una manera de insertar resultados dentro del texto escrito es utilizando el formato `` `r "\u0060r MiObjeto\u0060"` ``, donde `MiObjeto` es cualquier valor definido en los chunks del documento. Por ejemplo, puedo definir un objeto llamado *pvalue* en un reporte que genero mensualmente; cada vez que vuelvo a correr las sentencias, *pvalue* cambiar치 de valor.

* Si dentro del texto del reporte deseo mencionar el valor exacto de *pvalue*, el formato de c칩digo din치mico nos ayuda a imprimir de forma autom치tica este valor, sin tener que preocuparnos por cambiarlo manualmente.

* Probamos esta t칠cnica con un **test t** a dos colas, donde la hip칩tesis nula es $H_0)\mu=0$ y la alternativa $H_1)\mu\neq0$. En nuestro documento *.Rmd* tenemos este chunk:

````markdown
`r ''````{r, echo = FALSE}
`r ''`prueba <- t.test(rnorm(30), alternative = "two.sided", mu = 0) 
`r ''`pvalue <- prueba$p.value
`r ''````
````

```{r, echo=FALSE}
prueba <- t.test(rnorm(30), alternative = "two.sided", mu = 0)
pvalue <- prueba$p.value
```

* En alg칰n lugar del documento escribimos:

````markdown
Se realiz칩 la prueba T-Student (pvalue = `r '\x60r pvalue\x60'`).
````

* Y el resultado final en el archivo compilado ser치:

````markdown
Se realiz칩 la prueba T-Student (pvalue = `r pvalue`).
````

* Incluso el texto podr칤a estar controlado por objetos de R, como se puede ver en esta otra versi칩n m치s "sofisticada" del caso anterior. En el documento ponemos:

````markdown
El promedio `r '\x60r ifelse(pvalue <= 0.05, "", "no")\x60'` difiere significativamente de cero (pvalue = `r '\x60r round(pvalue, 4)\x60'`).
````

* Y el resultado final en el archivo compilado ser치:

````markdown
El promedio `r ifelse(pvalue < 0.05, "", "no")` difiere significativamente de cero (pvalue = `r round(pvalue, 4)`).
````

## Escritura matem치tica 

- R Markdown tambi칠n admite el uso de notaci칩n matem치tica para la escritura de f칩rmulas, siempre que encerremos la expresi칩n en cuesti칩n con un s칤mbolo "\$" si deseamos ecuaciones ubicadas en la misma l칤nea que el texto escrito, o bien mediante un doble s칤mbolo "\$$", para ecuaciones ubicadas en un nuevo rengl칩n.

- Por ejemplo `$\sum_{i=1}^{N} (x_i-\mu)^2$` se muestra como $\sum_{i=1}^{N} (x_i-\mu)^2$, mientras que `$$\sum_{i=1}^{N} (x_i-\mu)^2$$` se muestra como $$\sum_{i=1}^{N} (x_i-\mu)^2$$

- 쮻e d칩nde sale esa sucesi칩n extra침a de caracteres para definir la f칩rmula? R Markdown, como muchos otros lenguajes de marcado ligero, toma prestada la sintaxis de LaTeX para la escritura de f칩rmulas.

<!-- * Una *interminable* lista de operadores matem치ticos puede encontrarse [en este link](https://en.wikibooks.org/wiki/LaTeX/Mathematics). -->

* Una gran lista de ejemplos de notaci칩n matem치tica puede encontrarse [en este link](https://rpruim.github.io/s341/S19/from-class/MathinRmd.html).

* Veamos ahora algunos ejemplos de s칤mbolos y formatos comunes a la hora de escribir textos matem치ticos:

```
Operadores: 
$5 + z \leq 4 \times \sqrt[3]{x}$
```

$5 + z \leq 4 \times \sqrt[3]{x}$

```
Sub칤ndices y super칤ndices:
$x^2 + y^3 - z_0$
```

$x^2 + y^3 - z_0$

```
Letras griegas:
$\delta + \Delta + \gamma + \Gamma - \pi - \phi$
```

$\delta + \Delta + \gamma + \Gamma - \pi - \phi$

```
Fracciones:
$\frac{3}{4} + \frac{\lambda}{\omega}$
```

$\frac{3}{4} + \frac{\lambda}{\omega}$

```
Sumatorias:
$\sum_{i=1}^{N} (x_i-\mu)^2$
```

$\sum_{i=1}^{N} (x_i-\mu)^2$
$\displaystyle\sum_{i=1}^{N} (x_i-\mu)^2$

```
Integrales:
$\int_{0}^{+\infty} \cos{(x)}dx$
```

$\int_{0}^{+\infty} \cos{(x)}dx$
$\displaystyle\int_{0}^{+\infty} \cos{(x)}dx$

```
Especiales:
$\hat{\mu} = \bar{x} \iff \bar{x} = \hat{\mu}$
```

$\hat{\mu} = \bar{x} \iff \bar{x} = \hat{\mu}$


# Detalles espec칤ficos para html

- Todo lo que vimos hasta ac치 funciona para cualquier formato de salida deseado. Esta es una de las mayores virtudes de R Markdown, ya que podemos independizar nuestro trabajo de los detalles propios de cada sistema, generando cualquiera de ellos a partir del mismo script.

- Ahora bien, si tenemos en mente un formato de salida en particular, podemos personalizar a칰n m치s detalles con opciones espec칤ficas para ese formato.

- Una posible manera de lograr esto consiste en agregar detalles en la secci칩n `output` del encabezado *YAML*. 

* Por ejemplo, el encabezado del archivo que genera este HTML luce as칤:

```
---
title: "Comunicaci칩n de Resultados: R Markdown"
subtitle: "An치lisis Exploratorio de Datos | Licenciatura en Estad칤stica | FCEyE | UNR"
author: 
  - Mg. Diego Marfet치n Molina
  - Lic. Iv치n Millanes
date: "8/26/24"
lang: es
toc: true
format: 
  html:
    self-contained: true
    df-print: paged
    theme:
      light: journal
      dark: darkly
knitr:
  opts_chunk: 
    echo: true
    message: false
    warning: false
    fig.align: center
---
```

* `self-contained` indica que las figuras se deben incrustar en el c칩digo, con lo cual el documento es "portable" (cualquiera que tenga el HTML puede ver todas las im치genes incluidas).

* `theme` define el aspecto general del documento, con respecto a colores, sombreados, estilo del texto, etc. ([link a lista de temas disponibles](https://www.datadreaming.org/posts/2018-04-11-r-markdown-theme-gallery/2018-04-11-r-markdown-theme-gallery)).

<!-- * Las opciones que comienzan con `toc` hacen referencia a la "tabla de contenidos": queremos que est칠 presente (`yes`), que incluya hasta el tercer nivel de t칤tulos y que sea flotante para que siempre est칠 visible. -->

* Quienes se sientan c칩modos/as escribiendo c칩digo HTML, pueden definir m치s opciones de personalizaci칩n (colores, tama침os, fuentes, espaciados, etc.) en otro archivo de formato `.css` (*cascading style sheet*) y avisarle a R Markdown que lo tenga en cuenta nombr치ndolo en el encabezado:

```
--- 
title: "Comunicaci칩n de Resultados: R Markdown"
format: 
  html:
    self-contained: true
    df-print: paged
    css: archivo_de_estilo.css
---
```

* Otro aspecto que se puede personalizar bastante al trabajar con salida en html es la forma en la que se conjuntos de datos o tablas. Veamos algunas opciones:

- **Opci칩n 1**: agregar `df_print: paged` entre las opciones del output en el YAML, logrando que los conjuntos de datos se puedan explorar interactivamente.
  
- **Opci칩n 2**: usando el paquete `DT`, que con su funci칩n `datatable()`, que hace que los conjuntos de datos se presenten en tablas filtrables y reordenables. Ejemplo:

```{r}
mtcars %>% 
  datatable(filter = "top", options = list(scrollX = TRUE)) %>% 
  formatStyle(columns = 0:11, fontSize = "75%")
```

<br>

  - **Opci칩n 3**: combinar la funci칩n `kable()` del paquete `knitr` con funciones de configuraci칩n adicionales provistas por el paquete `kableExtra`. Por ejemplo, con las funciones `row_spec()` y `column_spec()` podemos modificar el aspecto del texto (color, formato, etc.) de columnas y filas determinadas; adem치s, agregamos una barra de desplazamiento para evitar imprimir la tabla entera mediante `scroll_box()`. Muchas m치s opciones de personalizaci칩n de tablas con `kableExtra` pueden consultarse en [su vi침eta oficial](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html).

```{r}
mtcars %>% 
  kable() %>% 
  kable_styling(font_size = 10, bootstrap_options = "hover") %>% 
  column_spec(1, bold = TRUE, background = "#DF0101", color = "white") %>% 
  row_spec(0, background = "#2E2E2E", bold = TRUE, color = "white") %>% 
  row_spec(4:5, italic = TRUE, color = "#2E9AFE") %>% 
  scroll_box(height = "300px")
```

<br>

  - **Opci칩n 4**: para tablas peque침as, podemos recurrir a [Tables Generator](https://www.tablesgenerator.com/markdown_tables). Generamos all칤 la tabla a mano, copiamos el c칩digo html y lo pegamos directamente en el Rmd.

<p></p>


# Detalles espec칤ficos para pdf

* Si queremos producir documentos en formato PDF desde RStudio, necesitamos tener instalado `LaTeX` en nuestra computadora... pero 쯤u칠 es `LaTeX`? Seg칰n [su propia web](https://www.latex-project.org/), `LaTeX` (pronunciado *latech*) es un sistema para preparaci칩n de documentos "de alta calidad".

* Incluye herramientas dise침adas para producir muchos tipos de documentaci칩n t칠cnica, gracias a lo cual se ha convertido en el programa *est치ndar* dentro del 치mbito acad칠mico y, sobre todo, de la divulgaci칩n cient칤fica (especialmente entre las ciencias duras).

```{r, echo=FALSE, out.width="30%"}
knitr::include_graphics('latex.png')
```

* La principal diferencia entre `LaTeX` y otros sistemas de generaci칩n de documentos de texto, como por ejemplo **Word**, puede resumirse en dos puntos:


    * En Word, lo que escribo (lo que veo en la pantalla) es lo que obtengo cuando guardo el documento
    * Con `LaTeX` no obtengo lo mismo que veo, sino que describo c칩mo quiero que luzca el documento mediante comandos espec칤ficos


* Al igual que R y RStudio, `LaTeX` es un software gratuito y de distribuci칩n libre. Una muestra de la gran cantidad de documentos que podemos crear mediante `LaTeX` puede consultarse en [Overleaf](https://www.overleaf.com/latex/templates), donde se listan ejemplos de libros, curr칤culums, posters, tesis y muchos otros formatos.

## Instalaci칩n de LaTeX

* La descarga y posterior instalaci칩n de `LaTeX` ha sido siempre proceso generalmente tedioso que puede variar mucho de una PC a otra, sobre todo debido a configuraciones de red, versiones de sistemas operativos, permisos para agregar paquetes, etc. 

* Para usuarios/as de Windows, la manera m치s recomendable de instalar `LaTeX` es a trav칠s de [MiKTeX](https://miktex.org/), una especie de "distribuidor oficial". Para usuarios/as de otros sistemas operativos, sugerimos consultar las mejores opciones [en la web oficial del proyecto LaTeX](https://www.latex-project.org/get/), o bien [aqu칤](https://en.wikibooks.org/wiki/LaTeX/Installation).

* **Sin embargo, quienes usan R no tienen de qu칠 preocuparse**. Se puede usar R para instalar una distribuci칩n de LaTeX minimalista que funciona como un encanto, con estos pasos:

```{r, eval = F}
# Primero, instal치 el paquete tinytex:
install.packages("tinytex")
# Luego, instal치 LaTeX corriendo en R:
tinytex::install_tinytex()
```

* Una vez instalado `LaTeX` (ya sea por fuera de R o con este paquete) no es necesario abrir este programa para poder utilizarlo, ya que RStudio se comunicar치 directamente con 칠l *detr치s de escena*, tal como lo hace con R.

* Cabe mencionar nuevamente a [Overleaf](https://es.overleaf.com/), que nos ofrece un editor online de `LaTeX` totalmente gratuito (requiere que nos registremos definiendo usuario y contrase침a) por si queremos hacer cosas en LaTeX sin instalar nada o en forma colaborativa.
    
## Opciones para LaTeX

* La principal diferencia con lo visto hasta aqu칤 es que en el encabezado YAML vamos a tener que especificar el tipo de salida que estamos buscando:

```{r, eval=FALSE}
---
title: "Mi Primer Markdown en PDF"
subtitle: "AED | Lic. en Estad칤stica | FCEyE | UNR"
author: "Diego & Iv치n"
date: "Agosto 2024"
output: pdf_document
---
```

* Para salidas en PDF, las opciones de personalizaci칩n del *YAML Metadata* se multiplican. Algunas de las m치s comunes son:


    * **fontsize:** tama침o de la fuente (*10pt*, *11pt*, *12pt*)
    * **geometry:** m치rgenes, orientaci칩n de la hoja, tama침o del papel (*a4paper*, *letterpaper*, etc.)
    * **documentclass:** tipo de documento (*article*, *report*, *book*, etc.)

<p></p>

* Al igual que R, el sistema `LaTeX` depende en gran medida de funciones que se encuentran disponibles en paquetes que deberemos instalar a medida que sean necesarios. La inclusi칩n de paquetes puede realizarse directamente en el encabezado, siguiendo el formato `\usepackage[opciones]{nombre_del_paquete}`.

* Durante la instalaci칩n, es posible configurar `LaTeX` para que los paquetes mencionados dentro del archivo que estamos ejecutando se instalen autom치ticamente, ahorr치ndonos la molestia de hacerlo manualmente (como en RStudio):

```{r, eval=FALSE}
---
title: "Mi Primer Markdown en PDF"
subtitle: "AED | Lic. en Estad칤stica | FCEyE | UNR"
author: "Diego & Iv치n"
date: "Agosto 2024"
fontsize: 12pt
geometry: a4paper
documentclass: article
output: pdf_document
header-includes:
  - \usepackage[spanish]{babel}
---
```

* En este caso, estamos utilizando el paquete `babel` con la opci칩n *spanish* para que ciertos aspectos del documento se generen en idioma espa침ol.

* Un comentario al paso: si lo que necesitamos es crear tablas, las funciones ya mencionadas del paquete `kableExtra` tambi칠n ofrecen opciones espec칤ficas para trabajar con LaTeX y poder generar lo que se necesita. Tambi칠n podemos generar la tabla en otro entorno, como el ya mencionado [Tables Generator](https://www.tablesgenerator.com/markdown_tables), y pegar el c칩digo de LaTeX directamente en el Rmd.

## Diapositivas

* Un formato 칰til de salida PDF es la presentaci칩n de diapositivas, la cual estamos acostumbrados a crear mediante programas como PowerPoint. En este caso la opci칩n que debemos elegir en el men칰 es **Presentation** y luego **PDF (Beamer)**:

```{r, echo=FALSE, out.width="75%"}
knitr::include_graphics('beamer1.png')
```

* El encabezado de nuestro **Rmd** luce as칤:

```{r, eval=FALSE}
---
title: "Mi Primer Documento Beamer"
subtitle: "An치lisis Exploratorio de Datos"
author: "Diego & Iv치n"
date: "Lic. en Estad칤stica - FCEyE - UNR"
output: beamer_presentation
---
```

* Si bien los comandos de `LaTeX` presentados en este tutorial son v치lidos tanto para reportes PDF como para diapositivas, diagramar informes o art칤culos es totalmente diferente a preparar una presentaci칩n en diapositivas.

* De forma *exageradamente* resumida podemos remarcar ciertas ventajas y desventajas al comparar las estructuras de estos diversos formatos:


    * **Ventajas** de utilizar Beamer: documento m치s compacto, el formato diapositiva permite una mejor separaci칩n de ideas
    * **Desventajas** de utilizar Beamer: hay que dedicarle mucho tiempo a organizar c칩digo, texto e im치genes para lograr que algunas ideas entren en una misma diapositiva

* En Beamer, podemos crear una nueva diapositiva mediante encabezados de primer (`#`) o segundo orden (`##`), o bien con tres asteriscos (`***`) o puntos (`---`) consecutivos.

```
# Titulo de la Diapo 1
Texto de la diapositiva 1

# Titulo de la Diapo 2
Texto de la diapositiva 2

***
Texto de la diapositiva 3 (esta diapo no tiene t칤tulo)
```

* Las presentaciones en Beamer se caracterizan por contar con una gran cantidad de **temas** (*themes*) disponibles para personalizar el aspecto de las diapositivas, con respecto a fuentes, colores y dem치s formatos.

* En el encabezado del documento podemos definir los temas a utilizar de la siguiente manera:

```{r, eval=FALSE}
---
title: "Mi Primer Documento Beamer"
subtitle: "An치lisis Exploratorio de Datos"
author: "Diego & Iv치n"
date: "Lic. en Estad칤stica - FCEyE - UNR"
output: beamer_presentation
theme: "Madrid"
colortheme: "orchid"
fonttheme: "serif"
---
```

* Una lista de los temas disponibles, tanto generales como de colores y fuentes, puede consultarse [en esta web](http://deic.uab.es/~iblanes/beamer_gallery/).

* En la siguiente imagen podemos apreciar el aspecto de las diapositivas generadas con el tema *Madrid*, color *orchid* y fuente *serif*:

```{r, echo=FALSE, out.width="80%"}
knitr::include_graphics('beamer2.png')
```

# Comentarios finales

* Con tantos t칠rminos dando vueltas (Markdown, RMarkdown, Knit, Pandoc, html, LaTeX... 游땠), lo natural es perderse y no saber qui칠n es qui칠n ni qu칠 hace qu칠.

* Lo bueno es que en general podemos usar todo esto sin tenerlo muy en claro, pero ac치 van algunas aclaraciones solo para los que est칠n interesados en saber m치s.

## Lenguajes de Marcado Ligero, Markdown y R Markdown

* Un lenguaje de marcado ligero (*markup language*) es un sistema estandarizado con reglas para insertar s칤mbolos en un documento de texto plano para controlar su estructura, formato y relaci칩n entre sus partes.

* Los s칤mbolos que se utilizan para este "marcado" son caracteres b치sicos interpretables por alg칰n dispositivo (computadora, impresora, navegador, etc.). Un documento con marcado ligero tiene entonces dos tipos de texto: texto para ser mostrado y caracteres que controlan la forma de mostrarlo.

* Dos lenguajes de marcado ligero muy conocidos y utilizados, aunque no muy sencillos de usar, son **XML** (Extensive Markup Language) y **HTML** (Hypertext Markup Language).

* Markdown es un lenguaje de marcado ligero muy sencillo de usar que s칩lo emplea caracteres simples (como numerales o asteriscos) para indicar el formato y la estructura del texto. Surgi칩 con la idea de simplificar algunos aspectos del lenguaje HTML, de modo que sea m치s f치cil editar contenido para p치ginas web.

* La idea de su desarrollador, John Gruber, era que sea una sintaxis f치cil de escribir, pero sobre todo de leer. A diferencia de lo que pasa con HTML, tranquilamente podemos abrir un documento marcado con Markdown (.md) y leer su texto sin problemas.

* Con el tiempo fueron surgiendo varios derivados, haciendo que no haya una sintaxis 칰nica de Markdown. Por ejemplo:

  - **Pandoc Markdown** es el nombre de una de estas versiones que extienden Markdown con sintaxis para incluir tablas, listas, pies de p치gina, citas, etc.

  - **R Markdown** se basa en Pandoc Markdown pero agrega sus propias reglas para poder incluir bloques de c칩digo de R y reglas, tanto para controlar su ejecuci칩n como la forma en la que se muestran los resultados. Los documentos escritos en R Markdown son de extensi칩n .Rmd (.qmd desde el lanzamiento de Quarto). Este lenguaje est치 implementado en el paquete `rmarkdown`.
  
* Adem치s de RStudio/Posit, algunas compa침칤as que tambi칠n utilizan Markdown son OpenAI (desarrolladora de ChatGPT), Discord, GitHub, Microsoft, Mozilla, entre otras.

## El proceso detr치s de R Markdown

* Una vez que hemos creado un archivo Rmd siguiendo las reglas de R Markdown y estamos listos para producir el resultado final, hacemos clic en el bot칩n Knit o, equivalentemente, corremos la funci칩n `render()` del paquete `rmarkdown`.

* Esta acci칩n genera un proceso de dos etapas:

    - El paquete `knitr` toma al archivo, identifica cu치les son las porciones de c칩digo a ejecutar, lo eval칰a, toma los resultados y los "incrusta" en el archivo siguiendo las reglas de markdown. Es decir, genera un archivo .md intermedio que no vemos, ni nos interesa.

    - Luego viene Pandoc, toma el archivo .md y lo convierte en un archivo de salida con el formato deseado: .html, .pdf o .docx, entre otros. Este programa ya viene instalado con RStudio, y lo mencionamos antes porque, adem치s de convertir los .md en el formato que queramos, es el software que implementa la versi칩n extendida del lenguaje *Pandoc's Markdown*.

  - Cuando el formato de salida es un PDF, hay un paso m치s. Pandoc convierte el .md en un archivo .tex, que sigue la sintaxis de LaTeX (por default este archivo es elimnado pero podr칤amos pedir que se conserve). Para convertir el .tex a un .pdf, se necesita que venga uno de los motores de compilaci칩n de LaTeX para hacer su tarea. Por defecto, se usa el motor `pdflatex`, pero hay otros disponibles (`xelatex` o `lualatex`). De estas instalaciones se encarga, por ejemplo, `tinytex`.

* 춰Voil! Con esos pasos m치gicos tenemos nuestro ansiado archivo. Debajo vemos un esquema que representa el proceso de compilaci칩n:

```{r, echo=FALSE, out.width="60%"}
knitr::include_graphics('proceso.png')
```

## Otros recursos relacionados al mundo de R Markdown

Si ten칠s ganas de seguir aprendiendo sobre `R Markdown`, pod칠s consultar esta peque침a lista de gu칤as y tutoriales:

* [Sitio oficial de R Markdown](https://rmarkdown.rstudio.com/)
* [R Markdown - The Definitive Guide (Libro de Yihui Xie)](https://bookdown.org/yihui/rmarkdown/)
* [Gu칤a de Referencia en la web de RStudio](https://rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf)
* [Machete en la web de RStudio](https://rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf)
* [Tips para mejorar el aspecto de un documento R Markdown](https://holtzy.github.io/Pimp-my-rmd/)
* [Paquete *knitr*](https://yihui.org/knitr/)
* [Paquete *bookdown*](https://bookdown.org/): para escribir y publicar nuestros propios libros desde R. Incluye formatos de salida HTML, PDF, ePub o Kindle, estos dos 칰ltimos para lectores de *ebooks*. El libro creado se puede hospedar de forma gratuita y sencilla en *GitHub* e integrarse a plataformas de Moodle.
* [Paquete *blogdown*](https://bookdown.org/yihui/blogdown/): permite desarrollar p치ginas web desde R.
* [Paquete *learnr*](https://rstudio.github.io/learnr/): permite transformar documentos Rmd en tutoriales interactivos para ser usados como material did치ctico.
* [Paquete *exams*](http://www.r-exams.org/): bas치ndose en R Markdown, permite generar autom치ticamente ejercicios para ex치menes de Moodle, con la posibilidad de no s칩lo emplear valores aleatorios sino tambi칠n preguntas aleatorias dentro de un mismo enunciado.
* Tutoriales de *gganimate*: [Post en *datanovia.com*](https://www.datanovia.com/en/blog/gganimate-how-to-create-plots-with-beautiful-animation-in-r/), [Vi침etas del paquete](https://gganimate.com/articles/gganimate.html) y [Laboratorio de experimentaci칩n de rOpenSci](https://github.com/ropenscilabs/learngganimate).

<!-- ## Trabajo en Equipo -->

<!-- * Crear un archivo **Rmd** con las siguientes especificaciones: -->


<!--     * **T칤tulo:** "An치lisis de datos de cultivos" -->
<!--     * **Autor:** nombre de los integrantes del grupo -->
<!--     * **Formato de salida:** HTML -->
<!--     * **C칩digo de R:** visible -->

<!-- <p></p> -->

<!-- * El objetivo del reporte es mostrar las siguientes figuras, armadas a partir de la base de cultivos presentada en clases anteriores. -->

```{r, echo=FALSE, eval=FALSE}
load("cultivos.RData")

z <- cultivos %>% 
  mutate(
    prov = ifelse(prov %in% c("BUENOS AIRES", "SANTA FE", "CORDOBA"), prov, "RESTO PAIS"),
    prov = factor(prov, levels = c("BUENOS AIRES", "CORDOBA", "SANTA FE", "RESTO PAIS")),
    cultivo = ifelse(cultivo %in% c("Ma칤z", "Soja", "Trigo"), cultivo, "Otros"),
    cultivo = factor(cultivo, levels = c("Ma칤z", "Soja", "Trigo", "Otros"))
    ) %>% 
  group_by(prov, cultivo) %>% 
  summarise(prod_millones = sum(prod)/1000000) %>% 
  ungroup()

z %>% 
  mutate(prod_millones = round(prod_millones, 2)) %>% 
  pivot_wider(names_from = cultivo, values_from = prod_millones) %>% 
  janitor::adorn_totals(where = c("row", "col")) %>% 
  kable() %>% 
  kable_styling() %>% 
  row_spec(0, bold = TRUE, background = "forestgreen", color = "white") %>% 
  row_spec(5, bold = TRUE, background = "lightgreen") %>% 
  column_spec(6, bold = TRUE)
  
ggplot(data = z) +
  aes(x = cultivo, y = prod_millones, fill = cultivo) +
  geom_bar(stat = "identity") +
  facet_wrap(vars(prov)) +
  labs(title = "Toneladas producidas en Argentina - Campa침a 2019/20",
       x = "Cultivo", y = "Tn. (en millones)") +
  theme_bw() +
  theme(legend.position = "none")
```
